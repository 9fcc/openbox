include build/Makefile.incl

dir = cwmcc

CPPFLAGS += $(GLIB_CFLAGS) $(XFT_CFLAGS) -DG_LOG_DOMAIN=\"CWMCC\"

target = libcwmcc.la
sources = cwmcc.c

srcdir := $(srcdir)/$(dir)
target := $(addprefix $(dir)/, $(target))
objects := $(addprefix $(dir)/, $(sources:.c=.lo))
sources := $(addprefix $(srcdir)/, $(sources))
deps := $(addprefix $(depdir)/, $(objects:.lo=.d))
depdir := $(depdir)/$(dir)

all: $(target)

$(target): $(objects)
	$(LINK) -o $@ $^ $(LDFLAGS)

$(dir)/%.lo: $(srcdir)/%.c $(depdir)/%.d
	$(LTCOMPILE) -c -o $@ $<

$(depdir)/%.d: $(srcdir)/%.c
	@echo Building dependancies for $<
	@$(INSTALL) -d $(depdir)
	@$(DEPCOMPILE) -w -MM -MF $@ -MQ $(<:.c=.o) $<

install:
	$(INSTALL) -d $(DESTDIR)$(libdir)/
	$(LIBTOOL) --mode=install $(INSTALL) $(target) \
		$(DESTDIR)$(libdir)/$(notdir $(target))

uninstall:
	$(LTRM) $(DESTDIR)$(libdir)/$(notdir $(target))

clean:
	$(LTCLEAN) $(target) $(objects)
	$(RM) $(srcdir)/*\~

distclean:

-include $(deps)

.PHONY: all install uninstall clean distclean
