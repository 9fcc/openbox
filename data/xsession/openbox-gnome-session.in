#!/bin/sh

if test -n "$1"; then
    echo "Syntax: openbox-gnome-session"
    echo
    echo "See the openbox-gnome-session(1) manpage for help."
  exit
fi

# Clean up after GDM
xprop -root -remove _NET_NUMBER_OF_DESKTOPS \
      -remove _NET_DESKTOP_NAMES \
      -remove _NET_CURRENT_DESKTOP 2> /dev/null

VER=$(gnome-session --version 2>/dev/null | \
      sed -e 's/[^0-9.]*\([0-9.]\+\)/\1/')

MAJOR=$(echo $VER | cut -d . -f 1)
MINOR=$(echo $VER | cut -d . -f 2)

# Run GNOME with Openbox as its window manager
export WINDOW_MANAGER="@bindir@/openbox"

if test $MAJOR -lt 2 || (test $MAJOR = 2 && test $MINOR -le 22); then
  # old gnome-session allows multiple sessions to be saved
  exec gnome-session --choose-session=openbox-session "$@"
else
  # make sure the gnome-wm script is being used
  gconftool-2 -t string \
      -s /desktop/gnome/session/required_components/windowmanager "gnome-wm" \
      2> /dev/null

  # new gnome-session does not allow multiple sessions
  exec gnome-session "$@"
fi



